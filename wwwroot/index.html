<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ear Worm</title>
    <base href="/" />
    <!-- Standard Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />

    <!-- Default values for additional CSS Variables (+ import Bootstrap Icons) -->
    <link href="_content/Havit.Blazor.Components.Web.Bootstrap/defaults.css" rel="stylesheet" />

    <!-- Blazor CSS Isolation -->
    <!--<link href="Your.Blazor.Project.Assembly.Name.styles.css" rel="stylesheet" /> -->
    <!-- <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" /> -->
    <link href="css/app.css" rel="stylesheet" />
    <link href="earworm.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="js/index.bundle.js"></script>
    <script src="js/pitcher.js"></script>
    <script src="js/pitchd2.js"></script>

    <script>
        window.xdrawStaff = (noteList) => {
            const VF = Vex.Flow;
            // Create an SVG renderer and attach it to the DIV element named "vf".
            const div = document.getElementById('vf');
            div.innerHTML = "";
            const renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);

            // Configure the rendering context.
            renderer.resize(500, 200);
            const context = renderer.getContext();
            context.setFont("Arial", 10, "").setBackgroundFillStyle("#eed");

            // Create a stave of width 400 at position 10, 40 on the canvas.
            const stave = new VF.Stave(10, 40, 400);

            // Add a clef and time signature.
            stave.addClef('treble').addTimeSignature('4/4');
            stave.setContext(context).draw();
            var notes = [
                // A quarter-note C.
                new VF.StaveNote({ keys: ["c/4"], duration: "q" }),

                // A quarter-note D.
                new VF.StaveNote({ keys: ["d/4"], duration: "q" }),

                // A quarter-note rest. Note that the key (b/4) specifies the vertical
                // position of the rest.
                new VF.StaveNote({ keys: ["b/4"], duration: "qr" }),

                // A C-Major chord.
                new VF.StaveNote({ keys: ["c/4", "e/4", "g/4"], duration: "q" })
            ];
            if (notes.length > 0) {
                var voice = new VF.Voice({ num_beats: 4, beat_value: 4 });

                //var notes = notes.map(n => new VF.StaveNote({ clef: "treble", keys: [n], duration: "q" }));
                console.log("notes" + notes);
                console.log("notes " + noteList.length);
                console.log("notes " + notes.length);
                var formatter = new VF.Formatter().joinVoices([voice]).format([voice], 350);
                voice.addTickables(notes);

                voice.draw(context, stave);
            }
            // Connect it to the rendering context and draw!
          
            //stave.setContext(context).draw();
        }

        window.xxdrawStaff = (noteList) => {
            const VF = Vex.Flow;
            // Create an SVG renderer and attach it to the DIV element named "vf".
            const div = document.getElementById('vf');
            div.innerHTML = "";
            var renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);

            // Configure the rendering context.
            renderer.resize(500, 200);
            var context = renderer.getContext();
            context.setFont("Arial", 10, "").setBackgroundFillStyle("#eed");

            // Create a stave of width 400 at position 10, 40 on the canvas.
            var stave = new VF.Stave(10, 40, 400);

            // Add a clef and time signature.
            stave.addClef("treble").addTimeSignature("4/4");

            // Connect it to the rendering context and draw!
            stave.setContext(context).draw();
            if (noteList.length == 0)
                return;
            // Create the notes
            var notes = [
                // A quarter-note C.
                //new VF.StaveNote({ keys: ["c/4"], duration: "q" }),

                // A quarter-note D.
                new VF.StaveNote({ keys: ["d/4"], duration: "q" }),

                // A quarter-note rest. Note that the key (b/4) specifies the vertical
                // position of the rest.
                new VF.StaveNote({ keys: ["b/4"], duration: "qr" }),

                // A C-Major chord.
                new VF.StaveNote({ keys: ["c/4", "e/4", "g/4"], duration: "q" })
            ];
            var notes = noteList.map(n => {
                var nt = new VF.StaveNote({ clef: "treble", keys: [n], duration: "q" });
                console.log(n);
                return nt;
            });
            // Create a voice in 4/4 and add above notes
            var voice = new VF.Voice({ num_beats: notes.length, beat_value: 4 });
            voice.addTickables(notes);

            // Format and justify the notes to 400 pixels.
            var formatter = new VF.Formatter().joinVoices([voice]).format([voice], 100*notes.length);

            // Render voice
            voice.draw(context, stave);
        }
    </script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
    <!-- Bootstrap JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>

</html>
